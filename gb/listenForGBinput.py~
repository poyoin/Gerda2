from GBInstruction import GBInstruction
from Instruction import Instruction
import re
import boto.sqs
from boto.sqs.message import Message
from datetime import datetime
from writeMessage import writeMessage
from addToGBDatabase import addToDatabase

# Connect to the queue server
conn = boto.sqs.connect_to_region("eu-central-1", aws_access_key_id = "AKIAI5H2RJ4GG4VZGLDQ", aws_secret_access_key = "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")
sendQueue = conn.get_queue('GB2Eco')
	
try:
	instruction = raw_input("Input: ")
	
	splitUp = re.split(',', instruction)
	fcpower = int(splitUp[0])
	throttleAdv = int(splitUp[1])
	steerAdv = int(splitUp[2])
	motorSet = int(splitUp[3])

	if len(splitUp) == 4:
		timestamp = datetime.now().strftime('%H:%M:%S.%f')[:-3]
		gb = GBInstruction(fcpower, throttleAdv, steerAdv, motorSet, timestamp)

	m = Message()
	m.set_body(writeMessage(gb))	
	sendQueue.write(m)
	print gb.toString() + " Sent to the EcoRunner
	addToDatabase(gb)

except ValueError:
	pass


	
